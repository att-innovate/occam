- name: Set /etc/hosts
  lineinfile: dest=/etc/hosts line="{{ management.ip }} ops1.{{ domain }} ops1"

- name: Configure Iptables
  template: src=iptables.rules
            dest=/etc/sysconfig/iptables
            mode=0600
            owner=root
            group=root
  notify:
    - restart iptables

- name: Enable Iptables Service
  service: name=iptables state=started enabled=true

- name: Configure Static Interfaces
  template: src=ifcfg-static
            dest="/etc/sysconfig/network-scripts/ifcfg-{{ item.key }}"
            mode=0644
            owner=root
            group=root
  with_dict: interfaces.static
  notify:
    - restart networking

- name: Configure DHCP Interfaces
  template: src=ifcfg-dhcp
            dest="/etc/sysconfig/network-scripts/ifcfg-{{ item.key }}"
            mode=0644
            owner=root
            group=root
  with_dict: interfaces.dhcp
  notify:
    - restart networking

- meta: flush_handlers

- name: Wait for networking...
  command: /bin/sleep 10
  async: 45
